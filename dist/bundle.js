var Tetris=function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){const i=n(2);t.exports=i.app},function(t,e,n){"use strict";n.r(e);var i={};n.r(i),n.d(i,"vec2",function(){return d}),n.d(i,"copy",function(){return l}),n.d(i,"equal",function(){return p}),n.d(i,"limit",function(){return f}),n.d(i,"makeMap",function(){return m}),n.d(i,"round",function(){return g}),n.d(i,"makeAttribute",function(){return w}),n.d(i,"add",function(){return y}),n.d(i,"sub",function(){return x}),n.d(i,"mul",function(){return v}),n.d(i,"div",function(){return b}),n.d(i,"scale",function(){return E}),n.d(i,"setScale",function(){return z}),n.d(i,"addScale",function(){return L}),n.d(i,"length",function(){return M}),n.d(i,"normalize",function(){return P}),n.d(i,"direction",function(){return C}),n.d(i,"cscale",function(){return A}),n.d(i,"csub",function(){return j}),n.d(i,"cadd",function(){return k}),n.d(i,"cmul",function(){return q});const r=void 0!==window.performance?window.performance:Date,s=()=>r.now(),h=window.requestAnimationFrame;function a(t,e=60){let n=!1,i=s(),r=0,a=1e3/e,o=0;this.start=()=>n?this:(n=!0,i=s(),r=h(u),this),this.stop=()=>(n=!1,0!=r&&h.cancel(r),r=0,this);const u=e=>{const n=e;(o+=n-i)-a>-1&&(t(a),o=0),i=n,r=requestAnimationFrame(u)}}function o(){let t;this.init=e=>{t=e},this.api=()=>({load:e=>{t.load(e)}})}const u=[{test:"png|jpg",loader:function(t,{assetsUrl:e}){return new Promise(n=>{let i=new Image;i.onload=()=>{n(i)},i.src=e+t})}},{test:"json",loader:function(t,{assetsUrl:e}){return fetch(e+t).then(t=>t.json())}}];function c(t,e){e={assetsUrl:"",...e};let{assetsUrl:n}=e,i=[...u];const r={assetsUrl:n},s={};Object.keys(t).length;let h=0;this.progress=()=>h,this.get=t=>s[t],this.start=()=>Promise.all(Object.values(function(t,e){let n={};return Object.keys(t).forEach(i=>{n[i]=e(i,t[i])}),n}(t,(t,e)=>{return a(e)(e,r).then(e=>{s[t]=e,h++})}))).then(t=>s);const a=t=>{let[e,n]=t.split("."),r=i.find(({test:t})=>n.match(t));return r?r.loader:(console.warn(`Couldn't find loader for ${t}, ignoring.`),()=>Promise.resolve())}}function d(t=0,e=t){return[t,e]}function l(t,e=[]){return e[0]=t[0],e[1]=t[1],e}function p(t,e){return t[0]===e[0]&&t[1]===e[1]}function f(t,e){t[0]=Math.max(t[0],e[0]),t[0]=Math.min(t[0],e[1]),t[1]=Math.max(t[1],e[2]),t[1]=Math.min(t[1],e[3])}function m(t){return e=>(e[0]=t(e[0]),e[1]=t(e[1]),e)}const g=m(t=>Math.round(t));function w(t){return(e=t[0],n=t[1])=>(t[0]=e,t[1]=n,t)}function y(t,e,...n){return t[0]+=e[0],t[1]+=e[1],n.forEach(e=>{t[0]+=e[0],t[1]+=e[1]}),t}function x(t,e){return t[0]-=e[0],t[1]-=e[1],t}function v(t,e){return t[0]*=e[0],t[1]*=e[1],t}function b(t,e){return t[0]/=e[0],t[1]/=e[1],t}function E(t,e){return t[0]*=e,t[1]*=e,t}function z(t,e,n){t[0]=e[0]*n,t[1]=e[1]*n}function L(t,e,n){return t[0]+=e[0]*n,t[1]+=e[1]*n,t}function M(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function P(t){return E(t,1/M(t)),t}function C(t,e){return P(j(e,t))}function A(t,e){return E(l(t),e)}function j(t,e){return x(l(t),e)}function k(t,e){return y(l(t),e)}function q(t,e){return v(l(t),e)}const{vec2:S}=i;function U(t){let e=this.data={touches:{}};function n(t,e,n){return t.addEventListener(e,n),()=>t.removeEventListener(e,n)}this.update=t=>{let{current:n,wheel:i}=e;i&&(i.handled?delete e.wheel:i.handled=!0),n&&(n.dpos=j(n.epos,n.start),n.tapping&&(n.tapping.handled?delete n.tapping:n.tapping.handled=!0),n.ending&&(n.ending.handled?delete e.current:n.ending.handled=!0))},this.bindTouch=()=>(function(t){const e=[],h=function(t){return function(e){e.preventDefault();const n=r(e);t.current={button:e.button,tapping:{},start:n,epos:n,dpos:S(0)}}}(t),a=function(t){return function(e){if(t.current){let{dpos:e}=t.current,n=s(e);t.current.ending={swipe:n}}}}(t),o=function(t){return function(e){const n=r(e);t.current&&(t.current.epos=n),t.epos=n}}(t),u=i(t);return["mousedown","touchstart"].forEach(t=>e.push(n(document,t,h))),["mousemove","touchmove"].forEach(t=>e.push(n(document,t,o))),["mouseup","touchend"].forEach(t=>e.push(n(document,t,a))),e.push(n(document,"wheel",u)),()=>{e.forEach(t=>t())}})(this.data);const i=t=>e=>{t.wheel={epos:r(e),y:Math.sign(e.deltaY)}},r=e=>{let n=(t=>t.clientX||0===t.clientX?[t.clientX,t.clientY]:t.touches&&t.targetTouches[0]?[t.targetTouches[0].clientX,t.targetTouches[0].clientY]:void 0)(e),{bounds:i}=t;return[n[0]-i.x,n[1]-i.y]};const s=t=>{let e={};return t[1]<-80?e.up=!0:t[1]>80&&(e.down=!0),t[0]<-80?e.left=!0:t[0]>80&&(e.right=!0),(e.up||e.down||e.left||e.right)&&(e.swiped=!0),e}}class T{constructor(t,e,n){this.l=t,this.c=e,this.n=n,this.p=null}r(){this.p?this.p.n=this.n:this.l.h=this.n,this.n&&(this.n.p=this.p)}}class D{constructor(){this.h=null}add(t){const e=new T(this,t,this.h);return this.h&&(this.h.p=e),this.h=e,e}i(t){let e=this.h;for(;e;)t(e.c),e=e.n}}const O={p:{t:0}};class _{constructor(t){this.z=t,this.o=new D,this.t=new D}add(t){t.remove(),t.l=this,t.n=(1!==t.a||0===t.frame.p.a?this.t:this.o).add(t)}}const B=(t,e)=>{const n=new _(0),i=[n],r=new ArrayBuffer(3407820),s=new Float32Array(r),h=new Uint32Array(r),{Point:a}=B,o=Object.assign({antialias:!1,alpha:!1},e),u=o.alpha?1:770,c=o.scale||1;delete o.scale;const d=t.getContext("webgl",o),l=d.getExtension("ANGLE_instanced_arrays"),p=(t,e)=>{const n=d.createShader(e);return d.shaderSource(n,t),d.compileShader(n),n},f=d.createProgram();d.attachShader(f,p("attribute vec2 g;\nattribute vec2 a;\nattribute vec2 t;\nattribute float r;\nattribute vec2 s;\nattribute vec4 u;\nattribute vec4 c;\nattribute float z;\nuniform mat4 m;\nvarying vec2 v;\nvarying vec4 i;\nvoid main(){\nv=u.xy+g*u.zw;\ni=c.abgr;\nvec2 p=(g-a)*s;\nfloat q=cos(r);\nfloat w=sin(r);\np=vec2(p.x*q-p.y*w,p.x*w+p.y*q);\np+=a+t;\ngl_Position=m*vec4(p,z,1);}",35633)),d.attachShader(f,p("precision mediump float;\nuniform sampler2D x;\nuniform float j;\nvarying vec2 v;\nvarying vec4 i;\nvoid main(){\nvec4 c=texture2D(x,v);\ngl_FragColor=c*i;\nif(j>0.0){\nif(c.a<j)discard;\ngl_FragColor.a=1.0;};}",35632)),d.linkProgram(f);const m=(t,e,n)=>{d.bindBuffer(t,d.createBuffer()),d.bufferData(t,e,n||35044)},g=(t,e,n,i,r,s,h)=>{const a=d.getAttribLocation(f,t);d.enableVertexAttribArray(a),d.vertexAttribPointer(a,e,s||5126,!!h,n||0,r||0),i&&l.vertexAttribDivisorANGLE(a,i)};m(34963,new Uint8Array([0,1,2,2,1,3])),m(34962,new Float32Array([0,0,0,1,1,0,1,1])),g("g",2),m(34962,r,35048),g("a",2,52,1),g("s",2,52,1,8),g("r",1,52,1,16),g("t",2,52,1,20),g("u",4,52,1,28),g("c",4,52,1,44,5121,!0),g("z",1,52,1,48);const w=t=>d.getUniformLocation(f,t),y=w("m"),x=w("x"),v=w("j");let b,E,z,L,M=0;const P=()=>{b=t.clientWidth*c|0,E=t.clientHeight*c|0;const e=t.width!==b||t.height!==E;return t.width=b,t.height=E,e},C=()=>{M&&(d.blendFunc(L?1:u,L?0:771),d.depthFunc(L?513:515),d.bindTexture(3553,z.p.t),d.uniform1i(x,z.p.t),d.uniform1f(v,L?z.p.a:0),d.bufferSubData(34962,0,s.subarray(0,13*M)),l.drawElementsInstancedANGLE(4,6,5121,0,M),M=0)},A=t=>{if(!t.visible)return;65535===M&&C();const{frame:e}=t,{uvs:n}=e;z.p.t!==e.p.t&&(z.p.t&&C(),z=e);let i=13*M;s[i++]=e.anchor.x,s[i++]=e.anchor.y,s[i++]=t.scale.x*e.size.x,s[i++]=t.scale.y*e.size.y,s[i++]=t.rotation,s[i++]=t.position.x,s[i++]=t.position.y,s[i++]=n[0],s[i++]=n[1],s[i++]=n[2],s[i++]=n[3],h[i++]=((16777215&t.tint)<<8|255*t.a&255)>>>0,s[i]=t.l.z,M++};let j,k=0,q=0;const S={gl:d,camera:{at:new a,to:new a,angle:0},background(t,e,n,i){d.clearColor(t,e,n,0===i?0:i||1)},layer(t){let e=i.find(e=>e.z===t);return e||(e=new _(t),i.push(e),i.sort((t,e)=>e.z-t.z)),e},add(t){n.add(t)},texture(t,e,n,i){const r=t.width,s=t.height,h=d.createTexture();return d.bindTexture(3553,h),d.texParameteri(3553,10240,9728|+n),d.texParameteri(3553,10241,9728|+n|+i<<8|+i<<1),d.texImage2D(3553,0,6408,6408,5121,t),i&&d.generateMipmap(3553),{size:new a(r,s),anchor:new a,uvs:[0,0,1,1],p:{a:0===e?0:e||1,t:h},frame(t,e,n){return{size:e,anchor:n||this.anchor,uvs:[t.x/r,t.y/s,e.x/r,e.y/s],p:this.p}}}},resize:P,render(){d.useProgram(f),d.enable(3042),d.enable(2929),k!=q&&(k=q,d.uniformMatrix4fv(y,!1,j)),d.viewport(0,0,b,E),d.clear(16640),z=O,L=!0,i.forEach(t=>t.o.i(A)),C(),L=!1;for(let t=i.length-1;t>=0;t--)i[t].t.i(A);C()}};return P(),j=(()=>{const{at:t,to:e,angle:n}=S.camera,i=t.x-b*e.x,r=t.y-E*e.y,s=Math.cos(n),h=Math.sin(n),a=2/b,o=-2/E;return[s*a,h*o,0,0,-h*a,s*o,0,0,0,0,-1e-5,0,(t.x*(1-s)+t.y*h)*a-2*i/b-1,(t.y*(1-s)-t.x*h)*o+2*r/E+1,0,1]})(),q++,S};B.Point=class{constructor(t,e){if(!(this instanceof B.Point))return new B.Point(t,e);this.set(t,e)}set(t,e){return this.x=t||0,this.y=e||(0!==e?this.x:0),this}},B.Sprite=class{constructor(t,e){Object.assign(this,{frame:t,visible:!0,position:new B.Point,rotation:0,scale:new B.Point(1),tint:16777215,a:1,l:null,n:null},e)}get width(){return this.frame.size.x*this.scale.x}set width(t){this.scale.x=t/this.frame.size.x}get height(){return this.frame.size.y*this.scale.y}set height(t){this.scale.y=t/this.frame.size.y}get alpha(){return this.a}set alpha(t){const e=t<1&&1===this.a||1===t&&this.a<1;this.a=t,e&&this.frame.p.a>0&&this.l&&this.l.add(this)}remove(){this.n&&this.n.r(),this.l=null,this.n=null}};var F=B;function I(t){const e=this.width=t.clientWidth,n=this.height=t.clientHeight,i=document.createElement("canvas");t.appendChild(i),i.width=e,i.height=n,this.bounds=t.getBoundingClientRect();const r=F(i);this.scene=r}function N(t){return{fourLayer:t.layer(4),threeLayer:t.layer(3),twoLayer:t.layer(2),oneLayer:t.layer(1),zeroLayer:t.layer(0),scene:t}}const{Point:W,Sprite:$}=F;function X(t){return new $(t)}function G(t=0,e=t){return new W(t,e)}const H=t=>(e,n,i,r=i,s)=>t.frame(G(e,n),G(i,r),G(s,s)),Y=(t,e)=>{[0,1,2,3,4,5,6,7,8,9,","].forEach((n,i)=>t["number"+n]=e(0,16*i,18,16))},R=(t,e)=>{t.qPlus=e(32,0,17,17),t.qDiv=e(64,0,18,17),t.qMinus=e(32,32,16,16),t.qDot=e(32,48,16,16),t.qQuestion=e(64,32,17,17)},Q=(t,e,n,i,r)=>[t(e,n,i,r),t(e+i,n,i,r),t(e+2*i,n,i,r),t(e,n+r,i,r),t(e+i,n+r,i,r),t(e+2*i,n+r,i,r),t(e,n+2*r,i,r),t(e+i,n+2*r,i,r),t(e+2*i,n+2*r,i,r)],V=(t,e)=>{t.button=e(0,0,32,16),t.upgrade=e(48,0,16),t.menuclose=e(32,0,16),t.menubg9=Q(e,0,16,16,16),t.upgradebg9=Q(e,48,16,16,32/3)};const J=t=>K(256,256,(e,n,i,r)=>(r.fillStyle=t,r.fillRect(0,0,e,n),i));function K(t,e,n){var i=document.createElement("canvas");return i.width=t,i.height=e,n(t,e,i,i.getContext("2d")),i}function Z(t){const{width:e,height:n}=t}function tt(t,e){this.A=t,this.B=e;this.Mid=[(t[0]+e[0])/2,(t[1]+e[1])/2];let n=e[0]-t[0],i=e[1]-t[1];this.translate=this.scale=n=>{return new tt(y(A(t,1-n),A(e,n)),y(A(t,n),A(e,1-n)))},this.pointFrom=(e,r)=>{return[t[0]+n*e-i*r,t[1]+i*e+n*r]}}function et(t,e){return new tt(t,e)}function nt(t,e,n,i){return new it(t,e,n,i)}function it(t,e,n,i){let r,s,h,a,o,u;this.width=n,this.height=i,this.copy=()=>new it(t,e,n,i),this.move=(c,d)=>{t=this.x=c,e=this.y=d,r=this.x1=t+n,s=this.y1=e+i,h=this.A=[t,e],a=this.B=[t,s],o=this.C=[r,s],u=this.D=[r,e],this.AB=et(h,a),this.BC=et(a,o),this.CD=et(o,u),this.DA=et(u,h)},this.move(t,e),this.contains=n=>t<n.x&&e<n.y&&r>n.x1&&s>n.y1,this.intersects=n=>!(t>n.x1||n.x>r)&&!(e>n.y1||n.y>s),this.containsPoint=(n,i)=>n>t&&n<r&&i>e&&i<s}function rt(t,e){e={name:"pool",warnLeak:400,...e};const n=(()=>{let t=0;return()=>t++})();let i=[],r=[];this.name=()=>e.name,this.alives=()=>i.length,this.total=()=>r.length+i.length,this.warnLeak=()=>e.warnLeak,this.toString=()=>`[${this.name()} alives: ${this.alives()} deads: ${r.length}]`,this.acquire=(e=(()=>{}))=>{let s;return this.total()>this.warnLeak()&&(console.warn(`possible pool leak at ${this.name()}.`),this.releaseLast()),e(s=r.length>0?r.pop():t(n())),i.push(s),s},this.acquireLimit=(t,e)=>{for(;this.alives()<e;)this.acquire(t)},this.release=t=>{this.releaseIndex(i.indexOf(t))},this.releaseIndex=t=>{t>-1&&r.push(i.splice(t,1)[0])},this.releaseLast=()=>{this.releaseIndex(0)},this.releaseAll=()=>{r=[...r,...i],i=[]},this.releaseIf=(t,e=(()=>{}))=>{let n=[],s=[];i.forEach(i=>{t(i)?(e(i),n.push(i)):s.push(i)}),i=s,r=[...n,...r]},this.reduce=(t,e)=>i.reduce(t,e),this.map=t=>i.map(t),this.flatMap=t=>i.flatMap(t),this.each=t=>{i.forEach(t)},this.find=t=>i.find(t)}function st(t,e,n){let i,r,s,{x:h,y:a,width:o,height:u,frame:c,alpha:d=1,angle:l=0}=n,p=X(c);p.alpha=d,p.width=o,p.height=u,this.init=t=>{i=0,r=0,s=t};const f=()=>h+i,m=()=>a+r;this.data=()=>s,this.update=t=>{},this.visible=t=>p.visible=t,this.alpha=t=>p.alpha=t,this.pos=()=>[i,r],this.move=(t,e)=>{i=t,r=e},this.bounds=()=>({x:f(),y:m(),width:o,height:u}),this.rotate=t=>l=t,this.resize=(t,e)=>{o=t,u=e,p.width=o,p.height=u},this.frame=t=>{p.frame=t,p.width=o,p.height=u},this.add=t=>{t.add(p)},this.remove=()=>{p.remove()},this.render=()=>{p.position.set(f(),m()),p.rotation=l}}function ht(t,e,n){let{size:i,x:r,y:s}=n,h=i,a=h-.15*i;const{frames:o}=e,u=t=>X(o["number"+t]);let c=[0,1,2,3,4,5,6,7,8,9].map(u),d=[",",","].map(u);const l=(t,e)=>{t.position.x=r+e,t.position.y=s,t.width=i,t.height=2*i},p=t=>{let e=0;t>1&&(t>2&&(t>3&&(t>4&&(t>5&&(t>6&&(l(c[6],e),e+=a,l(d[0],e),e+=a),l(c[5],e),e+=h),l(c[4],e),e+=h),l(c[3],e),e+=a,l(d[1],e),e+=a),l(c[2],e),e+=h),l(c[1],e),e+=h),l(c[0],e)};let f,m,g;p(),this.init=t=>{f=0,g=1},this.alpha=t=>{g=t},this.remove=()=>{c.forEach(t=>t.remove()),d.forEach(t=>t.remove())},this.add=t=>{c.forEach(e=>t.add(e)),d.forEach(e=>t.add(e))},this.setNumber=t=>{f!=t&&(m=t)},this.move=(t,e)=>{r=t,s=e,w()};const w=()=>{const t=function(t){const e=[];for(;t>0;)e.unshift(t%10),t=(t-t%10)/10;return e}(f);c.forEach(t=>t.alpha=0),d.forEach(t=>t.alpha=0),t.length>3&&(d[1].alpha=g),t.length>6&&(d[0].alpha=g),p(t.length),t.forEach((e,n)=>{const i=c[t.length-n-1];i.alpha=g,i.frame=o["number"+e]})};this.update=t=>{f!==m&&(f=m,w())},this.render=()=>{}}function at(t,e=t,{yoyo:n}){let i=0,r=1;const s=()=>{t!==e?((()=>i=0)(),r=1):(()=>i=1)()};return{update(t){(i+=t*r)>1&&(i=1,n&&(r*=-1)),i<0&&(i=0,n&&(r*=-1))},settled:(t=1)=>i>=t,progress:(t=1)=>i,both(n,i=n){t=n,e=i,s()},target:t=>(t&&(e=t,s()),e),value:n=>(n&&(t=n,s()),(()=>t+(e-t)*i)()),easing:n=>(n=>t+(e-t)*n(i))(n)}}function ot(t,e,n){const{frames:i,layers:{twoLayer:r}}=e;let s,h,a,o=new st(this,e,{x:0,y:0,width:20,height:20,frame:i.qPlus}),u=new ht(this,e,{x:0,y:0,size:20}),c=new at(0,0,{});this.init=t=>{s=t.x,h=t.y,a=t.tap,c.both(0,1),u.setNumber(a),u.add(r),o.add(r)};const d=()=>{o.remove(),u.remove(),t.releaseIncrement(this)};this.update=t=>{c.update(.002*t),u.update(),o.update(),c.settled()&&d()},this.render=()=>{let t=c.value(),e=120*t,n=1-(t>.6?t:0);u.move(s,h-e),u.alpha(n),o.move(s+-24,10+h-e),o.alpha(n),u.render(),o.render()}}function ut(t,e,n){let i,r=new rt(()=>new ot(this,e,n));this.init=t=>{i=t.tapper},this.update=t=>{r.each(e=>e.update(t))},this.tap=(t,e,n)=>{r.acquire(i=>i.init({tap:t,x:e,y:n}))},this.releaseIncrement=t=>r.release(t),this.render=()=>{r.each(t=>t.render())}}function ct(t,e,n){return()=>{const{current:i}=t.data;if(i){let{tapping:t,epos:r}=i;t&&((t,n)=>{let i=e.x,r=e.x+e.width,s=e.y,h=s+e.height;return i<=t&&r>t&&s<=n&&h>n})(...r)&&n(...r)}}}function dt(t,e){let n=t.x,i=t.y,r=t.x+t.width,s=t.y+t.height,h=(e.x,e.y,e.x+e.width),a=e.y+e.height,o=Math.min(n,e.x),u=Math.min(i,e.y);return{x:o,y:u,width:Math.max(r,h)-o,height:Math.max(s,a)-u}}function lt(t,e,n){const{events:i}=e;let r,s={x:n.x,y:n.y,width:n.width,height:n.height},h=new st(this,e,{...s,frame:n.frame});n.icon&&(r=new st(this,e,{x:n.x+.25*n.width,y:n.y,width:.5*n.width,height:n.height,frame:n.icon}));let a=[];this.init=t=>{h.init({}),a.push(h),r&&(r.init({}),a.push(r))},this.add=t=>{h.add(t),r&&r.add(t)},this.remove=()=>{h.remove(),r&&r.remove()},this.move=(t,e)=>{h.move(t,e),r&&r.move(t,e)};const o=ct(i,s,n.onClick);this.update=t=>{o(),a.forEach(e=>e.update(t))},this.render=()=>{a.forEach(t=>t.render())}}function pt(t,e,n){const{frames:i,layers:{zeroLayer:r,oneLayer:s}}=e;let h=new st(this,e,{x:0,y:0,width:n.width,height:n.height,frame:i.mdirt}),a=new ht(this,e,{x:n.score.x,y:n.score.y,size:n.score.height}),o=new lt(this,e,{x:n.upgrade.x,y:n.upgrade.y,width:n.upgrade.width,height:n.upgrade.height,frame:i.button,icon:i.upgrade,onClick:function(){t.toggleUpgradeMenu()}});let u,c=[];this.init=t=>{u=t.tapper,h.init({}),h.add(r),c.push(h),a.init({}),a.add(s),c.push(a),o.init({}),o.add(s),c.push(o)},this.update=t=>{a.setNumber(u.score()),c.forEach(e=>e.update(t))},this.render=()=>{c.forEach(t=>t.render())}}const ft=(t,e=50)=>{let n=!1;return(...i)=>{n||(n=!0,t(...i),setTimeout(()=>n=!1,e))}};function mt(t,e,n){const i={x:n.tap.x,y:n.tap.y,width:n.tap.width,height:n.tap.height},{events:r}=e;let s;this.init=t=>{s=t.tapper};const h=ct(r,i,ft((e,n)=>{t.tap(e,n)},100));this.update=t=>{h()},this.render=()=>{}}function gt(t,e,n){const i=(t,n)=>new st(this,e,{...t,frame:n});let r=n.frames,s=n.x,h=n.y,a=n.tileWidth,o=n.tileHeight||n.tileWidth,u=n.width-2*a,c=n.height-2*o,d=[{x:s,y:h,width:a,height:o},{x:s+a,y:h,width:u,height:o},{x:s+a+u,y:h,width:a,height:o},{x:s,y:h+o,width:a,height:c},{x:s+a,y:h+o,width:u,height:c},{x:s+a+u,y:h+o,width:a,height:c},{x:s,y:h+o+c,width:a,height:o},{x:s+a,y:h+o+c,width:u,height:o},{x:s+a+u,y:h+o+c,width:a,height:o}].map((t,e)=>i(t,r[e])),l=[];this.init=t=>{d.forEach(t=>{t.init({}),l.push(t)})},this.add=t=>{d.forEach(e=>{e.add(t)})},this.remove=()=>{d.forEach(t=>{t.remove()})},this.move=(t,e)=>{d.forEach(n=>n.move(t,e))},this.bounds=()=>d.map(t=>t.bounds()).reduce((t,e)=>dt(t,e)),this.update=t=>{l.forEach(e=>e.update(t))},this.render=()=>{l.forEach(t=>t.render())}}function wt(t,e,n){const{events:i}=e;let r,s,h,a,o,u,c=[],d=new at(0,0,{});this.init=t=>{r=0,s=0,h=0,a=0,o=0,d.both(0,0)},this.add=t=>{u=t,p()},this.remove=()=>{c.forEach(t=>t.remove())},this.addComponent=t=>{c.push(t)},this.move=(t,e)=>{r=t,s=e},this.bounds=()=>c.map(t=>t.bounds()).reduce((t,e)=>dt(t,e));const l=()=>{const{current:t}=i.data;if(t){let{ending:e,dpos:n}=t;(t=>{o=t,p()})(n[1]),e&&(a+=o,o=0)}},p=()=>{u&&c.forEach(t=>{!function(t,e){let n=t.x,i=t.x+t.width,r=e.x+e.width,s=e.x,h=t.y,a=t.y+t.height,o=e.y+e.height,u=e.y;return n<s&&h<u&&i>r&&a>o}(n,t.bounds())?t.remove():t.add(u)})},f=t=>{let e=d.value();if(d.update(.01*t),d.settled()){a>1&&d.both(a,0);const t=this.bounds();let e=t.y+t.height-(n.y+n.height);0===o&&e<-1&&d.both(a,a-e)}else a=e,p()};this.update=t=>{l(),c.forEach(e=>e.update(t)),f(t)},this.render=()=>{c.forEach(t=>t.move(r+h,s+a+o)),c.forEach(t=>t.render())}}function yt(t,e,n){const{frames:i,layers:{threeLayer:r,fourLayer:s}}=e;let h=new gt(this,e,{x:n.menu.x,y:n.menu.y,width:n.menu.width,height:n.menu.height,tileWidth:n.menuClose.width,frames:i.menubg9}),a=new lt(this,e,{x:n.menuClose.x,y:n.menuClose.y,width:n.menuClose.width,height:n.menuClose.height,frame:i.menuclose,onClick:function(){t.toggleUpgradeMenu()}}),o=new wt(this,e,{x:n.menu.x,y:n.menu.y+20,width:n.menu.width,height:n.menu.height-40});let u,c=new at(0,0,{}),d=[];this.init=t=>{u=t.tapper,h.init({}),d.push(h),o.init({}),l(),d.push(o),a.init({}),d.push(a)},this.add=()=>{c.both(1,0),h.add(r),a.add(r),o.add(s)};const l=()=>{u.upgrades().map((t,i)=>{let r=n.menuUpgrade.height,s=new xt(this,e,{x:n.menu.x+10,y:n.menu.y+50+i*(r+10),width:n.menu.width-20,height:r});return s.init({upgrade:t}),s}).forEach(t=>{o.addComponent(t)})};let p;this.remove=()=>{c.both(0,1),p=!0};this.update=t=>{c.update(.01*t);let e=c.value();p&&c.settled()&&(p=!1,h.remove(),a.remove(),o.remove()),d.forEach(t=>t.move(-e*n.menu.width,0)),d.forEach(e=>e.update(t))},this.render=()=>{d.forEach(t=>t.render())}}function xt(t,e,n){const{frames:i}=e;let r=new gt(this,e,{x:n.x,y:n.y,width:n.width,height:n.height,tileWidth:16,frames:i.upgradebg9}),s=[];this.init=t=>{r.init({}),s.push(r)},this.add=t=>{r.add(t)},this.remove=()=>{r.remove()},this.bounds=()=>r.bounds(),this.move=(t,e)=>{r.move(t,e)},this.update=t=>{s.forEach(e=>e.update(t))},this.render=()=>{s.forEach(t=>t.render())}}function vt(){let t,e,n,i;this.init=n=>{t=0,e=1,i=[1,2,3,4,5,6,7]},this.score=()=>t,this.tap=()=>e,this.menu=()=>n,this.tappy=()=>!n,this.upgrades=()=>i,this.doTap=()=>(t+=e,e),this.open=t=>{n=t},this.close=()=>{n=void 0},this.toggle=t=>{n?this.close():this.open(t)}}const bt={Upgrade:"upgrade"};function Et(t,e,n){const{frames:i,layers:{zeroLayer:r,oneLayer:s}}=e;let h,a=[],o=new ut(this,e,n),u=new pt(this,e,n),c=new mt(this,e,n),d=new yt(this,e,n);this.init=t=>{h=t.tapper,c.init({tapper:h}),a.push(c),u.init({tapper:h}),a.push(u),o.init({tapper:h}),a.push(o),d.init({tapper:h}),a.push(d)},this.tap=(t,e)=>{if(!h.tappy())return;let n=h.doTap();o.tap(n,t,e)},this.toggleUpgradeMenu=()=>{h.toggle(bt.Upgrade),h.menu()===bt.Upgrade?d.add():d.remove()},this.update=t=>{a.forEach(e=>e.update(t))},this.render=()=>{a.forEach(t=>t.render())}}function zt(t){const{config:e,canvas:n,layers:{scene:i,zeroLayer:r},frames:s}=t,h=(()=>{const{width:t,height:e}=n;let i=nt(10,10,20,20),r=nt(10,e-10-60,120,60),s=nt(i.x,40,t,e-4*i.height-r.height),h=.9*t,a=.8*e,o=.16*t,u=nt(.5*(t-h),.5*(e-a),h,a);return{menuClose:nt(u.x1-o,u.y-o,o,o),menuUpgrade:nt(0,0,t,90),menu:u,tap:s,score:i,upgrade:r,width:t,height:e}})();let a=[],o=new Et(this,t,h);this.init=t=>{let e=new vt;e.init({}),o.init({tapper:e}),a.push(o)},this.update=t=>{a.forEach(e=>e.update(t))},this.render=()=>{a.forEach(t=>t.render())}}function Lt(t,e){const n=new o;return new c({magic:"magic.png",numbers:"numbers.png",hud:"mhud.png"},{assetsUrl:"assets/images/"}).start().then(i=>{const r=new I(t),s=new U(r);s.bindTouch();const h=new Z(r),o=function(t,e){const n=t.texture(e.magic),i=H(n),r=t.texture(e.numbers),s=H(r),h=H(t.texture(e.hud)),a={};Y(a,s),R(a,s),V(a,h);const o=t.texture(J("white")),u=t.texture(J("black")),c=t.texture(J("#222222")),d=t.texture(J("#dddddd")),l=t.texture(J("#cccccc")),p=t.texture(J("brown")),f=t.texture(J("yellow")),m=t.texture(J("red")),g=t.texture(J("green"));return{mtree:i(0,0,8),mdirt:i(8,0,8),mdirtred:i(0,8,8),mdirtblue:i(8,8,8),mvill:i(16,0,8),mvillred:i(16,8,8),mvillblue:i(24,0,8),mmageright:i(0,16,8),mmageleft:i(8,16,8),mmagefront:i(0,24,8),mmageback:i(8,24,8),white:o,black:u,gray:c,gray2:d,gray3:l,brown:p,red:m,green:g,yellow:f,mage:f,platform:p,phandle:o,tPlay:m,toolbar:c,...a}}(r.scene,i);let u=new zt({config:function({events:t={}}){return{events:t}}(e),events:s,assets:i,canvas:r,hitBox:h,frames:o,layers:N(r.scene)});n.init(u),u.init({}),new a(t=>{s.update(t),u.update(t),u.render(),r.scene.render()}).start()}),n.api()}n.d(e,"app",function(){return Lt})}]);